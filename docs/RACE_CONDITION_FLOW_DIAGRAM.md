# Race Condition Handling - Flow Diagram

## Concurrent Booking Scenario

```
Time: T0 - Both teachers search for rooms
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Teacher A                          System                          Teacher B
   â”‚                                 â”‚                                 â”‚
   â”‚  Search for Room 101            â”‚                                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚  âœ… Room 101 Available          â”‚                                 â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  Search for Room 101            â”‚
   â”‚                                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  âœ… Room 101 Available          â”‚
   â”‚                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                 â”‚


Time: T1 - Teacher A clicks "Claim Room"
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Teacher A                          System                          Teacher B
   â”‚                                 â”‚                                 â”‚
   â”‚  Click "Claim Room"             â”‚                                 â”‚
   â”‚  (Opens modal)                  â”‚                                 â”‚
   â”‚                                 â”‚                                 â”‚


Time: T2 - Teacher B clicks "Claim Room" (1 second later)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Teacher A                          System                          Teacher B
   â”‚                                 â”‚                                 â”‚
   â”‚  (Reviewing booking details)    â”‚                                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  Click "Claim Room"             â”‚
   â”‚                                 â”‚  (Opens modal)                  â”‚
   â”‚                                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                 â”‚                                 â”‚


Time: T3 - Teacher A confirms booking
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Teacher A                          System                          Teacher B
   â”‚                                 â”‚                                 â”‚
   â”‚  Click "Confirm Booking"        â”‚                                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ ğŸ”’  â”‚ Acquire Lock                 â”‚
   â”‚                              â”‚Lock â”‚ (Room 101, Time Slot)        â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ âœ“   â”‚ Verify Teacher               â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ âœ“   â”‚ Verify Room                  â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ âœ“   â”‚ Check Overlaps               â”‚
   â”‚                              â”‚     â”‚ (None found)                 â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ ğŸ’¾  â”‚ Create Booking               â”‚
   â”‚                              â”‚ DB  â”‚ in Database                  â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ ğŸ”“  â”‚ Release Lock                 â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚  âœ… Success!                    â”‚                                 â”‚
   â”‚  "Room booked successfully"     â”‚                                 â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  ğŸ“¡ Socket.IO Event             â”‚
   â”‚                                 â”‚  "bookingCreated"               â”‚
   â”‚                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚  (Auto-refresh results)         â”‚
   â”‚                                 â”‚                                 â”‚


Time: T4 - Teacher B confirms booking (2 seconds after Teacher A)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Teacher A                          System                          Teacher B
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  Click "Confirm Booking"        â”‚
   â”‚                                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ ğŸ”’  â”‚ Try Acquire Lock             â”‚
   â”‚                              â”‚Lock â”‚ (Room 101, Time Slot)        â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ âœ“   â”‚ Verify Teacher               â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ âœ“   â”‚ Verify Room                  â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ âŒ  â”‚ Check Overlaps               â”‚
   â”‚                              â”‚     â”‚ CONFLICT DETECTED!           â”‚
   â”‚                              â”‚     â”‚ (Teacher A's booking)        â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ ğŸ”“  â”‚ Release Lock                 â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  âŒ Error 409                   â”‚
   â”‚                                 â”‚  "Room already booked           â”‚
   â”‚                                 â”‚   by Teacher A"                 â”‚
   â”‚                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  ğŸ“¡ Socket.IO Event             â”‚
   â”‚                                 â”‚  "bookingConflict"              â”‚
   â”‚                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  Shows error toast:             â”‚
   â”‚                                 â”‚  "Room already booked           â”‚
   â”‚                                 â”‚   by Teacher A"                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  Auto-refreshes search          â”‚
   â”‚                                 â”‚  (Room 101 removed)             â”‚
   â”‚                                 â”‚                                 â”‚
```

## Alternative Scenario: Lock Conflict

```
Time: T0 - Both teachers click "Confirm" at exactly the same time
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Teacher A                          System                          Teacher B
   â”‚                                 â”‚                                 â”‚
   â”‚  Click "Confirm" (T0.000s)      â”‚  Click "Confirm" (T0.001s)      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                 â”‚                                 â”‚
   â”‚                              â”Œâ”€â”€â”´â”€â”€â”                              â”‚
   â”‚                              â”‚ ğŸ”’  â”‚ Lock Race!                   â”‚
   â”‚                              â”‚     â”‚ Teacher A: âœ… Lock acquired  â”‚
   â”‚                              â”‚     â”‚ Teacher B: âŒ Lock denied    â”‚
   â”‚                              â””â”€â”€â”¬â”€â”€â”˜                              â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚  Processing...                  â”‚  âŒ Immediate Error 409         â”‚
   â”‚                                 â”‚  "Another teacher is            â”‚
   â”‚                                 â”‚   currently booking"            â”‚
   â”‚                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚  ğŸ“¡ "bookingConflict"           â”‚
   â”‚                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚  (Continues with booking)       â”‚  Shows error:                   â”‚
   â”‚                                 â”‚  "Please wait and try again"    â”‚
   â”‚                                 â”‚                                 â”‚
```

## System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (React)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ TeacherDashboard â”‚  â”‚ RoomRecommendationâ”‚  â”‚ MyBookings   â”‚ â”‚
â”‚  â”‚     Page         â”‚  â”‚      Card         â”‚  â”‚   Section    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                     â”‚          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                 â”‚                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚  useBookingUpdates Hook â”‚                  â”‚
â”‚                    â”‚  (Socket.IO Client)     â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                 â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Socket.IO Events      â”‚
                    â”‚  â€¢ bookingCreated          â”‚
                    â”‚  â€¢ bookingConflict         â”‚
                    â”‚  â€¢ bookingCanceled         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend (Express)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚   Socket.IO Server      â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                 â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Room Booking Routes                            â”‚   â”‚
â”‚  â”‚  POST /api/room-bookings                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚                                â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚           â”‚                     â”‚                     â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ RoomLockService â”‚  â”‚ Prisma Database â”‚  â”‚ ErrorHandler   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                â”‚ â”‚
â”‚  â”‚ â€¢ acquireLock() â”‚  â”‚ â€¢ findFirst()   â”‚  â”‚ â€¢ sendError()  â”‚ â”‚
â”‚  â”‚ â€¢ releaseLock() â”‚  â”‚ â€¢ create()      â”‚  â”‚ â€¢ BOOKING_     â”‚ â”‚
â”‚  â”‚ â€¢ getLockHolderâ”‚  â”‚                 â”‚  â”‚   CONFLICT     â”‚ â”‚
â”‚  â”‚ â€¢ cleanup()     â”‚  â”‚                 â”‚  â”‚                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Lock Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Lock Lifecycle                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Request Arrives
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Try Acquire Lockâ”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â”‚           â”‚
   YES          NO
     â”‚           â”‚
     â–¼           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Lock â”‚   â”‚ Return 409       â”‚
  â”‚ Set  â”‚   â”‚ "Currently       â”‚
  â”‚      â”‚   â”‚  booking"        â”‚
  â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Process      â”‚
  â”‚ Booking      â”‚
  â”‚ (max 30s)    â”‚
  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Release Lock â”‚
  â”‚ (Success or  â”‚
  â”‚  Failure)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Parallel Process:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Every 60s:   â”‚
  â”‚ Cleanup      â”‚
  â”‚ Expired      â”‚
  â”‚ Locks        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Timing

- **Lock Duration**: 30 seconds
- **Cleanup Interval**: 60 seconds
- **Socket.IO Latency**: < 100ms
- **Database Query**: < 50ms
- **Total Booking Time**: 200-500ms (typical)

## Success Metrics

- âœ… **Zero Double Bookings**: Lock prevents conflicts
- âœ… **Fast Response**: < 500ms for booking confirmation
- âœ… **Real-Time Updates**: < 100ms for Socket.IO events
- âœ… **User Feedback**: Immediate error messages
- âœ… **Automatic Recovery**: Expired locks cleaned up
